<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="991px" height="1461px" viewBox="-0.5 -0.5 991 1461" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2022-04-17T18:12:02.040Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 12_0_1) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/14.4.3 Chrome/87.0.4280.141 Electron/11.3.0 Safari/537.36&quot; etag=&quot;LoZp1rB6UqcCOXAshKn-&quot; version=&quot;14.4.3&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;3b20BdGqKjfSOICx5HSt&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><path d="M 430 90 L 430 133.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 430 138.88 L 426.5 131.88 L 430 133.63 L 433.5 131.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="370" y="30" width="120" height="60" rx="9" ry="9" fill="#d5e8d4" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 60px; margin-left: 371px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">百万并发请求到来</div></div></div></foreignObject><text x="430" y="64" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">百万并发请求到来</text></switch></g><path d="M 510 40 L 510 73.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 510 78.88 L 506.5 71.88 L 510 73.63 L 513.5 71.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 530 40 L 530 73.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 530 78.88 L 526.5 71.88 L 530 73.63 L 533.5 71.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 550 40 L 550 73.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 550 78.88 L 546.5 71.88 L 550 73.63 L 553.5 71.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 365 180 L 286.37 180" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 281.12 180 L 288.12 176.5 L 286.37 180 L 288.12 183.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 170px; margin-left: 325px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">缓存命中</div></div></div></foreignObject><text x="325" y="174" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">缓存命中</text></switch></g><path d="M 430 220 L 430 323.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 430 328.88 L 426.5 321.88 L 430 323.63 L 433.5 321.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 267px; margin-left: 431px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">缓存未命中<br />要查数据库了</div></div></div></foreignObject><text x="431" y="270" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">缓存未命中&#xa;要查数据库了</text></switch></g><path d="M 430 140 L 495 180 L 430 220 L 365 180 Z" fill="#f8cecc" stroke="#b85450" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 180px; margin-left: 366px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">查询Redis缓存</div></div></div></foreignObject><text x="430" y="184" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">查询Redis缓存</text></switch></g><rect x="160" y="150" width="120" height="60" rx="9" ry="9" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 180px; margin-left: 161px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">返回缓存数据</div></div></div></foreignObject><text x="220" y="184" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">返回缓存数据</text></switch></g><path d="M 370 375 L 350 375 L 350 310 L 400 310 L 400 323.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 400 328.88 L 396.5 321.88 L 400 323.63 L 403.5 321.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 430 390 L 430 433.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 430 438.88 L 426.5 431.88 L 430 433.63 L 433.5 431.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 415px; margin-left: 430px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">成功</div></div></div></foreignObject><text x="430" y="418" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">成功</text></switch></g><rect x="370" y="330" width="120" height="60" rx="9" ry="9" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 360px; margin-left: 371px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">获取Redis分布式锁<br />并设置过期时间</div></div></div></foreignObject><text x="430" y="364" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">获取Redis分布式锁...</text></switch></g><rect x="510" y="325" width="480" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 478px; height: 1px; padding-top: 335px; margin-left: 512px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">这里加锁是为了避免「缓存击穿」<br />（如果key在大量请求进来前正好失效，那所有的查询落到了数据库里）</div></div></div></foreignObject><text x="512" y="339" fill="#000000" font-family="Helvetica" font-size="12px">这里加锁是为了避免「缓存击穿」&#xa;（如果key在大量请求进来前正好失效，那所有的查询落到了数据库里）</text></switch></g><rect x="240" y="320" width="110" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 345px; margin-left: 295px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">未获取锁成功，<br />线程休眠200ms后<br />重试自旋获取锁</div></div></div></foreignObject><text x="295" y="349" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">未获取锁成功，线程休眠200ms后...</text></switch></g><path d="M 370 480 L 286.37 480" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 281.12 480 L 288.12 476.5 L 286.37 480 L 288.12 483.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 430 520 L 430 563.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 430 568.88 L 426.5 561.88 L 430 563.63 L 433.5 561.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 545px; margin-left: 430px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">缓存未命中</div></div></div></foreignObject><text x="430" y="548" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">缓存未命中</text></switch></g><path d="M 430 440 L 490 480 L 430 520 L 370 480 Z" fill="#f8cecc" stroke="#b85450" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 480px; margin-left: 371px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">查询Redis缓存</div></div></div></foreignObject><text x="430" y="484" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">查询Redis缓存</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 470px; margin-left: 325px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">缓存命中</div></div></div></foreignObject><text x="325" y="474" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">缓存命中</text></switch></g><rect x="160" y="450" width="120" height="60" rx="9" ry="9" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 480px; margin-left: 161px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">返回缓存数据</div></div></div></foreignObject><text x="220" y="484" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">返回缓存数据</text></switch></g><rect x="510" y="430" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 480px; margin-left: 512px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">这里多一次查询Redis缓存的原因是<br /><div><span>设想个场景：</span></div><div>第一个和第二个线程都因为没读到缓存同时竞争分布式锁，</div><div>第一个线程获取到了锁，第二个线程没有，在等待重试自选获取锁</div><div>这时候第一个线程查好数据库、放入缓存、释放锁、返回了</div><div>这时候第二个线程获取到了锁，就不应该再查数据库了</div><div>所以这时候应该再查下Redis缓存，有数据就直接返回</div></div></div></div></foreignObject><text x="512" y="484" fill="#000000" font-family="Helvetica" font-size="12px">这里多一次查询Redis缓存的原因是...</text></switch></g><path d="M 430 630 L 430 683.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 430 688.88 L 426.5 681.88 L 430 683.63 L 433.5 681.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="370" y="570" width="120" height="60" rx="9" ry="9" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 600px; margin-left: 371px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">查询数据库<br />并存入Redis缓存</div></div></div></foreignObject><text x="430" y="604" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">查询数据库&#xa;并存入Redis缓存</text></switch></g><rect x="370" y="690" width="120" height="60" rx="9" ry="9" fill="#d5e8d4" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 720px; margin-left: 371px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">无论是否抛异常<br />最后都要释放锁</div></div></div></foreignObject><text x="430" y="724" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">无论是否抛异常&#xa;最后都要释放锁</text></switch></g><path d="M 160 390 L 155 390 Q 150 390 150 400 L 150 530 Q 150 540 145 540 L 142.5 540 Q 140 540 145 540 L 147.5 540 Q 150 540 150 550 L 150 680 Q 150 690 155 690 L 160 690" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="0" y="525" width="150" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 540px; margin-left: 75px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">临界区<br />同时只有一个线程在执行</div></div></div></foreignObject><text x="75" y="544" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">临界区&#xa;同时只有一个线程在执行</text></switch></g><rect x="500" y="575" width="400" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 585px; margin-left: 700px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">目的：只要整个流程第一次缓存查询没命中，只有一个线程能查询数据库</div></div></div></foreignObject><text x="700" y="589" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">目的：只要整个流程第一次缓存查询没命中，只有一个线程能查询数据库</text></switch></g><rect x="100" y="790" width="710" height="80" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 830px; margin-left: 102px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">加锁<br />setnx("lock", xxx)：只有key不存在时候能设置占用，否则不行<br />setnx ex 设置过期时间：业务代码异常或者程序在页面过程 中宕机。没有执行删除锁逻辑，这就造成了死锁，所以要给锁加过期时间<br />设置锁是需要原子性的，这是为了怕加锁和设置过期时间中间断电宕机了，这样又死锁无法释放了<br />有时候业务代码执行很长时间，超过了锁的过期时间，为了删锁时候不要删了别人的，需要加锁时指定值为uuid，只能删自己的锁</div></div></div></foreignObject><text x="102" y="834" fill="#000000" font-family="Helvetica" font-size="12px">加锁setnx("lock", xxx)：只有key不存在时候能设置占用，否则不行...</text></switch></g><rect x="510" y="695" width="460" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 720px; margin-left: 512px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">删锁<br />删锁时候不要删了别人的，要删自己的锁，所以需要加锁时要对比锁value，再去删锁<br />设置锁是需要原子性的，用Redis lua脚本来保证</div></div></div></foreignObject><text x="512" y="724" fill="#000000" font-family="Helvetica" font-size="12px">删锁删锁时候不要删了别人的，要删自己的锁，所以需要加锁时要对比锁value，再去删锁...</text></switch></g><rect x="510" y="760" width="240" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 775px; margin-left: 512px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">原子性：<br />多条指令要么全部执行，要么全不执行回滚</div></div></div></foreignObject><text x="512" y="779" fill="#000000" font-family="Helvetica" font-size="12px">原子性：&#xa;多条指令要么全部执行，要么全不执行回滚</text></switch></g><rect x="510" y="365" width="410" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 380px; margin-left: 512px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">可能代码执行时间太长，锁都自动释放了，所以锁的过期时间放长点，30s<br />同时过期时间要设置随机性，这是为了避免「缓存雪崩」</div></div></div></foreignObject><text x="512" y="384" fill="#000000" font-family="Helvetica" font-size="12px">可能代码执行时间太长，锁都自动释放了，所以锁的过期时间放长点，30s...</text></switch></g><rect x="500" y="605" width="460" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 615px; margin-left: 730px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">这里查询数据库如果没有数据的话，也给Redis缓存存个null，这是避免「缓存穿透」</div></div></div></foreignObject><text x="730" y="619" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">这里查询数据库如果没有数据的话，也给Redis缓存存个null，这是避免「缓存穿透」</text></switch></g><path d="M 120 780 L 360 390" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="2 6" pointer-events="stroke"/><path d="M 430 990 L 430 1023.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 430 1028.88 L 426.5 1021.88 L 430 1023.63 L 433.5 1021.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="370" y="930" width="120" height="60" rx="9" ry="9" fill="#d5e8d4" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 960px; margin-left: 371px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">修改数据库中数据</div></div></div></foreignObject><text x="430" y="964" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">修改数据库中数据</text></switch></g><rect x="405" y="0" width="50" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 10px; margin-left: 430px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">读请求</div></div></div></foreignObject><text x="430" y="14" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">读请求</text></switch></g><path d="M 430 1190 L 430 1223.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 430 1228.88 L 426.5 1221.88 L 430 1223.63 L 433.5 1221.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="370" y="1130" width="120" height="60" rx="9" ry="9" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1160px; margin-left: 371px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">删掉原来的Redis缓存</div></div></div></foreignObject><text x="430" y="1164" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">删掉原来的Redis缓存</text></switch></g><rect x="550" y="1085" width="180" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1095px; margin-left: 640px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">用SpringCache的@CacheEvict</div></div></div></foreignObject><text x="640" y="1099" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">用SpringCache的@CacheEvict</text></switch></g><rect x="370" y="1230" width="120" height="60" rx="9" ry="9" fill="#d5e8d4" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1260px; margin-left: 371px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">下次查询数据的时候就会去数据库查询最新数据了</div></div></div></foreignObject><text x="430" y="1264" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">下次查询数据的时候就会去数据库查询最新数据了</text></switch></g><rect x="405" y="900" width="50" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 910px; margin-left: 430px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">写请求</div></div></div></foreignObject><text x="430" y="914" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">写请求</text></switch></g><rect x="520" y="1115" width="240" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1125px; margin-left: 640px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">为了保证缓存数据的一致性，采用失效模式</div></div></div></foreignObject><text x="640" y="1129" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">为了保证缓存数据的一致性，采用失效模式</text></switch></g><path d="M 430 1090 L 430 1123.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 430 1128.88 L 426.5 1121.88 L 430 1123.63 L 433.5 1121.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="370" y="1030" width="120" height="60" rx="9" ry="9" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1060px; margin-left: 371px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">加上写锁</div></div></div></foreignObject><text x="430" y="1064" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">加上写锁</text></switch></g><rect x="240" y="1330" width="380" height="130" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1395px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div>我们系统的一致性解决方案: </div><div><br /></div><div>1、缓存的所有数据都有过期时间，数据过期下一次查询触发主动更新</div><div><br /></div><div>2、读写数据的时候，加上分布式的读写锁。</div><div><br /></div><div>3、采取失效模式</div><div><br /></div><div>偶尔写，经常读</div></div></div></div></foreignObject><text x="242" y="1399" fill="#000000" font-family="Helvetica" font-size="12px">我们系统的一致性解决方案:...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>